<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8">
	<title>Rebooting Reiot</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description" content="A social game developer wandering strange dungeons...">
	<meta name="author" content="Ray Yun">
  <meta name="apple-mobile-web-app-capable" content="yes">

    <!-- Le styles -->
	
    <link href="/assets/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/css/bootstrap-responsive.min.css" rel="stylesheet">
    <link href="/assets/js/google-code-prettify/prettify.css" rel="stylesheet">
    <link href="/assets/css/droppress.css" rel="stylesheet">
	

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="/assets/ico/favicon.ico">
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="/assets/ico/apple-touch-icon-57-precomposed.png">
  </head>

  <body>

    <div class="navbar navbar-fixed-top navbar-inverse">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="/">Rebooting Reiot</a>
          <div class="nav-collapse">
            <ul class="nav">
              <li class="active"><a href="/">Home</a></li>
              <li><a href="/archives/">Archives</a></li>
              <li><a href="/category/">Categories</a></li>
              <li><a href="/tag/">Tags</a></li>
			  
            </ul>
            <form class="navbar-search pull-right">
              <input type="text" class="search-query" placeholder="Title Search">
            </form>
            <ul class="nav">
              <li><a id="random-post" href="#"><span class="icon-random icon-white"></span> </a></li>
            </ul>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>

	
<div class="container">

	

	<div class="row">
		<div class="span9">
			
				<div>
	<div class="page-header">
		<h1><a href="/2008/03/16/boost-asio-udp-relay-server/">boost::asio udp relay server</a> <small>2008-03-16</small></h1>
	</div>
	<div><p>조만간 회사에서 쓸 일이 있을 것 같아서 만들어본 udp relay 서버. 하는 일이라고는 패킷을 잠시 저장해뒀다가 원래 주소로 쏘는 일인데, ASIO를 쓰면 얼마나 코드가 간단해질까 해서 만들어봤다. 이 코드는 서버에만 쓰고, 클라이언트에 붙일 넘은 IOCP까지는 필요없고 그냥 Win32 + winsock2 + 폴링 쓰레드로 만들어볼까 싶다.</p>
<pre><code>
class udp_relay_server
{
    struct relay_policy
    {
        udp::endpoint from_, to_;
        DWORD delay_;
    };

    struct relay_message
    {
        boost::shared_ptr&lt;std::string&gt; message_;
        udp::endpoint destination_;
        DWORD expire_clock_;
    };

    enum
    {
        MIN_SLEEP_DELAY = 10
    };

public:

    udp_relay_server(boost::asio::io_service&amp; io_service, short port)
        : socket_(io_service, udp::endpoint(udp::v4(), port))
        , timer_(io_service)
    {
        do_receive();
        do_timer();
    }

    udp_relay_server(boost::asio::io_service&amp; io_service, const udp::endpoint &amp; endpoint_ )
        : socket_(io_service, endpoint_)
        , timer_(io_service)
    {
        do_receive();
        do_timer();
    }

    void add_policy( const udp::endpoint &amp; from_, const udp::endpoint &amp; to_, DWORD delay = 0 )
    {
        relay_policy p;
        p.from_ = from_;
        p.to_ = to_;
        p.delay_ = delay;
        policies.push_back(p);
    }

    void add_policy( string from_addr, short from_port, string to_addr, short to_port, DWORD delay = 0 )
    {
        udp::endpoint from_( boost::asio::ip::address::from_string(from_addr), from_port );
        udp::endpoint to_( boost::asio::ip::address::from_string(to_addr), to_port );
        add_policy( from_, to_, delay );
    }

    void clear_policy() { policies.clear(); }

private:

    void do_timer()
    {
        timer_.expires_from_now(boost::posix_time::milliseconds(MIN_SLEEP_DELAY));
        timer_.async_wait(boost::bind(&amp;udp_relay_server::handle_timer,this,boost::asio::placeholders::error));
    }

    void handle_timer( const boost::system::error_code &amp; ec )
    {
        if ( !queue_.empty() )
        {
            DWORD cur_clock = GetTickCount();
            std::list&lt; relay_message &gt;::iterator itr = queue_.begin();
            while ( itr != queue_.end() )
            {
                relay_message &amp; m = *itr;
                if ( cur_clock &gt; m.expire_clock_ )
                {
                    socket_.async_send_to(boost::asio::buffer(*m.message_), m.destination_,
                        boost::bind(&amp;udp_relay_server::handle_send, this, m.message_, boost::asio::placeholders::error, boost::asio::placeholders::bytes_transferred) );
                    itr = queue_.erase(itr++);
                }
                else
                {
                    itr++;
                }
            }
        }
        do_timer();
    }

    void do_receive()
    {
        socket_.async_receive_from(
            boost::asio::buffer(recv_buffer_), remote_endpoint_,
            boost::bind(&amp;udp_relay_server::handle_receive, this,
            boost::asio::placeholders::error,
            boost::asio::placeholders::bytes_transferred));
    }

    void handle_receive(const boost::system::error_code&amp; error, std::size_t bytes_transferred)
    {
        if (!error)
        {
            bool bRelayed = false;
            for(size_t i = 0 ; i &lt; policies.size() ; i ++ )
            {
                relay_policy &amp; p = policies[i];
                if ( p.from_ == remote_endpoint_ )
                {
                    udp::endpoint relay_to(p.to_);
                    boost::shared_ptr&lt;std::string&gt; message(new string(recv_buffer_.data(),bytes_transferred));
                    if ( p.delay_ &gt; 0 )
                    {
                        relay_message m;
                        m.message_ = message;
                        m.destination_ = relay_to;
                        m.expire_clock_ = GetTickCount() + p.delay_;
                        queue_.push_back( m );
                    }
                    else
                    {
                        do_send( message, relay_to );
                    }
                    bRelayed = true;
                    break;
                }
            }
            do_receive();
        }
    }

    void do_send( boost::shared_ptr&lt;std::string&gt; message, const udp::endpoint &amp; destination )
    {
        socket_.async_send_to(boost::asio::buffer(*message), destination,
            boost::bind(&amp;udp_relay_server::handle_send, this,
                message, boost::asio::placeholders::error, boost::asio::placeholders::bytes_transferred) );
    }

    void handle_send(boost::shared_ptr&lt;std::string&gt; message, const boost::system::error_code&amp; error, std::size_t bytes_transferred )
    {
    }

    udp::socket socket_;
    udp::endpoint remote_endpoint_;
    boost::array&lt;char, 128&gt; recv_buffer_;
    vector&lt;relay_policy&gt; policies;
    boost::asio::deadline_timer timer_;
    std::list&lt; relay_message &gt; queue_;
};
</code></pre></div>
	<br />
	<p>
	
	
	</p>
</div>
			
				<div>
	<div class="page-header">
		<h1><a href="/2008/03/01/rbo-on-cnn/">제가 참가했던 프로젝트가 CNN을 탔습니다</a> <small>2008-03-01</small></h1>
	</div>
	<div><p><img alt="http://nckstudio.com/wp-content/uploads/2008/02/ripken.jpg" src="http://nckstudio.com/wp-content/uploads/2008/02/ripken.jpg" /></p>
<p><a href="http://nckstudio.com/">제가 몸담고 있는 회사</a>에서 <a href="http://www.playrealbaseball.com/">서비스중인 게임</a>이 <a href="http://www.cnn.com/video/#/video/sports/2008/02/28/intv.cal.ripken.cnn?iref=videosearch">CNN 방송에 등장</a>했습니다.  <a href="http://www.youtube.com/watch?v=Rhq9ZcZ-_U0">유투브에도 해당 방송 분량</a>이 따로 올라왔네요. 언뜻 보기엔 좀 오래된 게임처럼 보이지만,  정말로 오래된 게임이라서 그렇습니다 :(</p>
<p>저도 저 게임의 서버와 P2P, DB쪽 유지 보수 작업을 잠시 맡았다가, 지금은 저 게임의 후속작을 개발중입니다.  혹시나 MLB 2k7 이나 MLB 07 같은 리얼 온라인 야구 게임에 관심있는 개발자분들이 계시다면 <a href="http://reiot.cafe24.com/contact/">연락</a> 바랍드립니다. 참고로 <a href="http://kini.tistory.com/461">미국에서는 불세출의 야구 영웅</a>이라고 칭송받지만, 우리 회사에서는 그냥 횽아라고 불리는 <a href="http://en.wikipedia.org/wiki/Cal_Ripken,_Jr.">칼 립켄 주니어</a>는 저희 회사의 주주이기도 합니다.</p>
<p>see also:</p>
<ul>
<li><a href="http://nckstudio.com/2008/02/29/rbo-on-cnn/">http://nckstudio.com/2008/02/29/rbo-on-cnn/</a></li>
</ul></div>
	<br />
	<p>
	
		<a href="/category/gamedev/"><span class="label label-info"><span class="icon icon-folder-open"></span> gamedev</span></a>
	
	
	</p>
</div>
			
				<div>
	<div class="page-header">
		<h1><a href="/2008/02/22/wow-warden-as-spyware/">WOW Warden as Spyware</a> <small>2008-02-22</small></h1>
	</div>
	<div><p><img alt="Exploiting Online Games: Cheating Massively Distributed Systems" src="http://ecx.images-amazon.com/images/I/311RgaO6v4L.jpg" /></p>
<p><a href="http://www.amazon.com/exec/obidos/ASIN/0132271915/ref=nosim/learreio-20">Exploiting Online Games</a>에 와우의 보안 프로그램인 <a href="http://en.wikipedia.org/wiki/Warden_%28software%29">Warden</a>이 어떻게 동작하는지에 대한 간략한 설명이 나와 있다.</p>
<ul>
<li>서버로부터 실시간으로 전송받는 듯하다. (스크립트일지도?)</li>
<li>15초에 한번씩 사용자의 컴퓨터를 검색한다.</li>
<li>와우 클라이언트의 주소 공간에 로딩된 모든 DLL 의 정보를 읽어들인다. (ToolHelp API)</li>
<li>모든 윈도우 타이틀의 텍스트를 GetWindowTextA 로 읽어들인 다음, 해싱을 거쳐서 미리 등록된 금지 어플리케이션 목록과 비교한다.</li>
<li>모든 프로세스의 코드 영역(0x004<strong><em>* 이나 0x0041</em></strong>*)의 10-20바이트를 읽어서, 역시 해싱을 거쳐 미리 등록된 금지 어플리케이션 목록과 비교한다.</li>
</ul>
<p><a href="http://www.rootkit.com/">이 책의 저자는</a>, 윈도우 타이틀에 SSN이나 카드 번호, URL, 이메일 등의 개인 정보가 블리자드로 빠져나갈 수 있고, 또한 내가 실행하고 있는 프로세스의 기밀 정보가 유출될 수 있기에, Warden이 안티해킹툴이라기 보다는 스파이웨어라고 주장하고 있다.</p>
<p>한 명의 게이머의 입장에서는 저자의 주장에 수긍이 가지만, 이런 저런 해킹에 시달리는 게임 개발자의 관점에서 보면 이런 통계 기반의 해킹 체크도 한번 도입해보면 재미있지 않을까 하는 호기심도 솟아오른다. 우헷.</p></div>
	<br />
	<p>
	
	
	</p>
</div>
			
				<div>
	<div class="page-header">
		<h1><a href="/2008/02/22/boostasio-documentation/">boost::asio documentation</a> <small>2008-02-22</small></h1>
	</div>
	<div><p><a href="http://c10k.googlecode.com/svn/trunk/Doxyfile">doxygen 환경 파일</a>과 <a href="http://c10k.googlecode.com/svn/trunk/asio.chm">직접 컴파일한 CHM 파일</a>을 구글 코드에 올려뒀으니 관심있는 분들의 많은 애용 바랍니다.</p>
<p>단, chm 파일이 80메가가 넘으므로, 환경 파일을 받고 OUTPUT_DIRECTORY라든지 STRIP_FROM_PATH 등을 적당히 고친 후 직접 컴파일하는게 나을 수도 있겠네요 :)</p>
<p>제 홈페이지에서도 직접 받으실 수 있습니다.</p>
<ul>
<li><a href="http://reiot.cafe24.com/Doxyfile">boost asio doxygen configuration</a></li>
<li><a href="http://reiot.cafe24.com/asio.chm">boost asio compiled html(chm)</a></li>
</ul></div>
	<br />
	<p>
	
	
	</p>
</div>
			
				<div>
	<div class="page-header">
		<h1><a href="/2008/02/18/getting-real/">Getting Real</a> <small>2008-02-18</small></h1>
	</div>
	<div><p><a href="http://gettingreal.37signals.com/GR_kor.php">Getting Real</a>은 단지 웹개발에 대한 지침이기도 하지만, 쌓여 있는 버그와 뒤죽박죽한 요구 사항 속에서 고민하는 게임 개발자에게도 꽤 유익한 내용이다. 가끔씩 길을 잘못 들고 있지 않을까 하는 불안감이 들 때마다 읽어봐야겠다.<br />
```<br />
<strong>"혁신은 '아니오' 에서 시작된다."</strong></p>
<p>[혁신]은 1000가지 일에 대해서 '아니오'라고 말하므로써 잘못된 길을 가거나 불필요하게 너무 많은 일을 하지 않도록 하는 것에서 시작됩니다. 우리는 항상 새롭게 진입가능한 시장에 대해서 고민합니다. 하지만 그것은 과감히 '아니오'라고 말하므로써 실질적으로 중요한 일들에 대해서만 집중할 수 있을 때 가능합니다.<br />
<cite>—Steve Jobs, CEO, <a href="http://www.apple.com/">Apple</a> (from <a href="http://www.businessweek.com/bwdaily/dnflash/oct2004/nf20041012_4018_db083.htm">The Seed of Apple's Innovation</a>)<br />
</cite></p>
<p><strong>"천 개의 기능은 필요하지 않습니다."</strong></p>
<p>스티브 잡스가 아이튠즈에 대해서 독립음반회사 사람들을 모아놓고 조그만 발표를 했습니다. 그 날 많은 사람들은 쉴 새없이 손을 들면서 어떤 기능이 제공되는 지, 혹은 어떤 기능을 추가할 계획이 있는 지 물었습니다. 마침내 쟙스가 말했습니다. "잠깐만요. 손을 잠시 내리고 제 말을 들어보시죠. 저는 여러분이 아이튠즈에 있으면 좋을 만한 아이디어를 수 천개 가지고 있다는 것을 잘압니다. 하지만 우리는 수 천개의 기능을 원하지 않습니다. 그렇게 하면 엉망이 될 겁니다. 혁신은 모든 것에 대해서 '예'라고 말하는 것이 아닙니다. 혁신은 정말 중요한 것을 제외한 나머지에 대해서는 '아니오'라고 말하는 것입니다."</p>
<p><cite>—Derek Sivers, 대표 및 프로그래머, <a href="http://www.cdbaby.com/">CD Baby</a>  and <a href="http://www.hostbaby.com/">HostBaby</a></cite><cite>(from <a href="http://www.oreillynet.com/onlamp/blog/2004/08/say_no_by_default.html">Say NO by default</a>)</cite>```<br />
그러고 보면  헛똑똑이질을 하다가 매번 revert를 하다가 저런 글을 보고 뉘우치곤 하는 나보다, 이런 류의 글따위는 한번도 읽어보진 않아도 뭐가 중요한지 몸으로 깨닫고 있는 모군이 2g 정도 대견스럽긴 하다. ㅋㅋ</p></div>
	<br />
	<p>
	
	
	</p>
</div>
			
			<div class="pagination pagination-centered">
				<ul>
				
					<li><a href="/page/17/">&laquo;</a></li>
				
				
				  	<li >
				  	
				    	<a href="/page/18/">18</a>
				    
				  	</li>
		  		
				  	<li >
				  	
				    	<a href="/page/19/">19</a>
				    
				  	</li>
		  		
				  	<li class="active">
				  	
				    	<a href="/page/20/">20</a>
				    
				  	</li>
		  		
				  	<li >
				  	
				    	<a href="/page/21/">21</a>
				    
				  	</li>
		  		
				  	<li >
				  	
				    	<a href="/page/22/">22</a>
				    
				  	</li>
		  		
				  	<li >
				  	
				    	<a href="/page/23/">23</a>
				    
				  	</li>
		  		
				
					<li><a href="/page/24/">&raquo;</a></li>
				
		  		</ul>
			</div>
		</div>
		<div class="span3">
			<ul class="nav nav-list well dsq-widget">
	<li>
		
		<a href="http://facebook.com/reiot" style="display: inline-block"><img src="/assets/img/facebook.png" /></a>
		
		
		<a href="http://twitter.com/reiot" style="display: inline-block"><img src="/assets/img/twitter.png" /></a>
		
	    <a href="atom.xml" style="display: inline-block"><img src="/assets/img/rss.png" /></a>
	</li>
	<li class="nav-header">
		Recent Posts
	</li>
	
	<li>
		<a href="/2008/03/16/boost-asio-udp-relay-server/">boost::asio udp relay server</a>
	</li>
	
	<li>
		<a href="/2008/03/01/rbo-on-cnn/">제가 참가했던 프로젝트가 CNN을 탔습니다</a>
	</li>
	
	<li>
		<a href="/2008/02/22/wow-warden-as-spyware/">WOW Warden as Spyware</a>
	</li>
	
	<li>
		<a href="/2008/02/22/boostasio-documentation/">boost::asio documentation</a>
	</li>
	
	<li>
		<a href="/2008/02/18/getting-real/">Getting Real</a>
	</li>
	
	<li class="nav-header dsq-widget-title">
		Recent Comments
	</li>
	<script type="text/javascript" src="http://reiot.disqus.com/recent_comments_widget.js?num_items=5&hide_avatars=0&avatar_size=32&excerpt_length=200"></script>
</ul>
		</div>
	</div>

	<footer>
	<p class="pull-right">
		<a href="http://github.com/Reiot/droppress" class="btn btn-success btn-mini">powered by DropPress 0.0.1</a>
	</p>
</footer>

</div> <!-- /container -->


    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
	
    <script src="/assets/js/jquery.js"></script>
    <script src="/assets/js/google-code-prettify/prettify.js"></script>
    <script src="/assets/js/bootstrap.min.js"></script>
    <script src="/assets/js/droppress.js"></script>
	

  
  <script type="text/javascript">

    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-247024-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();

  </script>
  

  </body>
</html>