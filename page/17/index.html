<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
	<title>Rebooting Reiot</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description" content="Social Game Developer wandering strange dungeon...">
	<meta name="author" content="Ray Yun">

    <!-- Le styles -->
	
    <link href="/assets/css/bootstrap.min.css" rel="stylesheet">
    <style>
      body {
        padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
      }
    </style>
    <link href="/assets/css/bootstrap-responsive.min.css" rel="stylesheet">
	

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="/assets/ico/favicon.ico">
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="/assets/ico/apple-touch-icon-57-precomposed.png">
  </head>

  <body>

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="/">Rebooting Reiot</a>
          <div class="nav-collapse">
            <ul class="nav">
              <li class="active"><a href="/">Home</a></li>
              <li><a href="/archives/">Archives</a></li>
              <li><a href="/category/">Categories</a></li>
              <li><a href="/tag/">Tags</a></li>
			  
            </ul>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>

	
<div class="container">

	<div class="row">
		<div class="span9">
			
				<article>
	<div class="page-header">
		<h1><a href="/2008/05/01/customize-wordpress-prologue-theme/">Customize Wordpress Prologue theme</a> <small>2008-05-01</small></h1>
	</div>
	<div><p><a href="http://boxcatstudio.files.wordpress.com/2009/07/prologue.png"><img alt="http://boxcatstudio.files.wordpress.com/2009/07/prologue-269x300.png" src="http://boxcatstudio.files.wordpress.com/2009/07/prologue-269x300.png" /></a></p>
<p>이런 저런 스트레스가 머리끝까지 다다른 어느날, 불현듯 팀 내에 저레벨(?) 커뮤니케이션의 필요성이 느껴져서, 얼마전부터 <a href="http://wordpress.com/blog/2008/01/28/introducing-prologue/">prologue </a>테마를 한글화해서 뒷담화 온라인이라는 이름으로 절찬리에 운영중이다. 며칠 쓰다보니 외부 링크를 보다 손쉽게 추가할 수 있게 해달라는 요청이 들어와서, Custom Field 를 저장하고 보여주는 기능을 구현해봤다.</p>
<p>가장 먼저 post-form.php 에 link 라는 이름의 input text 필드를 추가했다.</p>
<pre><code>
&lt;input type=&quot;text&quot; name=&quot;link&quot; id=&quot;link&quot; autocomplete=&quot;off&quot; /&gt;

</code></pre>

<p>이걸 link 라는 이름의 custom field 로 저장하기 위해서 function.php 에 다음과 같은 함수와 콜백을 추가했다.</p>
<pre><code>
function add_link_custom_field($post_id) {
if( $_POST['link'] ) {
add_post_meta($post_id, 'link', $_POST['link'], true) or update_post_meta($post_id, 'link', $_POST['link']);
}
}
add_action('publish_post', add_link_custom_field );
</code></pre>

<p>이제 글을 작성할 때마다 link 폼으로 넘어온 값이 custom field 에 저장이 될 것이다. 다음은 이걸 화면에 아이콘으로 보여주는 코드를 살펴보자.</p>
<pre><code>
&lt;?php
$links = get_post_custom_values('link');
if(count($links)&gt;0)
{
echo &quot;&lt;a href='&quot; . $links[0] . &quot;'&gt;&lt;img src='/blog/wp-content/uploads/link.jpg' /&gt;&lt;/a&gt;&quot;;
}
?&gt;

</code></pre>

<p>가끔은 정형화된 인트라넷에서는 쏟아낼 수 없는, 너무 소소하고 쓸데없는 잡담들을 펼쳐줄 공간이 회사원에게는 필요할지도 모르겠다. 물론 그걸 악용하고 소모적으로 사용하는 경우는 없어야겠지만. 결국은 쓰는 사람이 그 선을 잘 지켜줘야 할 게다. 그런 의미에서 확실히 자신의 얼굴을 보여준다는 건 참 괜찮은 아이디어인 듯하다.</p></div>
	
</article>
			
				<article>
	<div class="page-header">
		<h1><a href="/2008/04/14/boost-with-visual-studio-2008-express/">boost with Visual Studio 2008 express</a> <small>2008-04-14</small></h1>
	</div>
	<div><p>visual studio express 시리즈들이 커맨드라인 빌드를 지원하지 않는다고만 알고 있었는데, 구글님께 여쭤보니 역시나 해결책이 있었다.<br />
<code>bjam --toolset=msvc-9.0express --with-system --with-thread --with-date_time --with-regex --with-serialization --with-test --stagedir=. debug release link=static runtime-link=shared threading=multi stage</code></p></div>
	
</article>
			
				<article>
	<div class="page-header">
		<h1><a href="/2008/04/05/boost-135/">boost 1.35</a> <small>2008-04-05</small></h1>
	</div>
	<div><p>지난 달에 boost 1.34.1 을 일년만에 업그레이드해서 소스 트리에 넣었다가 느리다는 불평을 많이 들었는데, 금방 <a href="http://boost.org/users/news/version_1_35_0">1.35가 나와버렸다</a>. 이번에는 <a href="http://boost.org/libs/asio/index.html">ASIO 가 정식으로 포함</a>되었고, 그 외에 <a href="http://boost.org/libs/circular_buffer/index.html">Circular Buffer</a> 라든지 <a href="http://boost.org/libs/interprocess/index.html">Interprocess </a>같은 라이브러리들이 새로 추가되었다.</p>
<p>이 정도라면 boost 만으로도 game server 을 만들어내도 될 법한 분위기렸다. 누가 boost.reliable_udp 이라든지 boost.patch, boost.crash_dump 같은 거 만들어줬으면...</p></div>
	
</article>
			
				<article>
	<div class="page-header">
		<h1><a href="/2008/03/21/svn-mkactivity-403-forbidden/">SVN MKACTIVITY 403 Forbidden</a> <small>2008-03-21</small></h1>
	</div>
	<div><p>회사에서 <a href="http://www.subversionary.org/sspidomainauth">Collabnet Subversion 에 SSPI 를 연동</a>해서 별 문제없이 사용하던 어느 날, 저장소에 Boost 1.34.1 트리를 넣고 난 다음부터 update/commit 이 무지막지하게 느려졌었다. 혹시나 신 버전에서는 해결된 문제가 아닐까 해서 Collabnet 을 업그레이드했으나, 역시나 파일 개수가 많아서 생긴 문제였고, 날 잡아서 사용하지 않는 서드파티 라이브러리들을 모조리 삭제하고 난 후에야 그럭저럭 제 속도를 얻을 수 있었다.</p>
<p>그러나, 이게 끝이 아니었으니,  갑자기 미국에 출장간 일부 개발자들이 update는 되는데 commit이 안된다는 보고를 해왔다. 아파치 로그를 살펴보니</p>
<p>Access denied: '<username>' MKACTIVITY <repository-name>:</p>
<p>라는 메시지가 나왔다. 그렇다고 모두 안되면 다시 롤백이라도 하겠는데, 특정 사용자만 안되었고, 새로 만든 아이디를 만들어서 권한을 부여해도 안되고, 그런데 또 관리자 계정을 사용하면 되는 기묘한 현상이었다.</p>
<p>3-4 시간 정도 구글링해본 결과 도무지 해답을 찾을 수가 없어서, 포기하고 Collabnet Enterprise Subversion 을 구매하려다가 놀랄만한 가격 때문에 좌절해있던 찰라, 문제를 보고한 개발자가 <a href="http://www.alagad.com/go/blog-entry/subversion-mkactivity-and-403-forbidden-headaches">한방에 구글에서 해답</a>을 찾아내었다.  정답은 subversion 서버의 버전이 올라가면서 레파지토리 이름의 대소문자를 타이트하게 구분하게 되면서 생긴 문제였다. 결국 relocating만 하면 해결되는 것이었다는 슬픈 전설이 전해진다.</p>
<p>이 이야기의 교훈은, 구글 검색어를 어떻게 조합하냐에 따라 O(N^2)으로 해결할 문제도 O(1)로 해결할  수 있다..일까?</p></div>
	
</article>
			
				<article>
	<div class="page-header">
		<h1><a href="/2008/03/16/boost-asio-udp-relay-server/">boost::asio udp relay server</a> <small>2008-03-16</small></h1>
	</div>
	<div><p>조만간 회사에서 쓸 일이 있을 것 같아서 만들어본 udp relay 서버. 하는 일이라고는 패킷을 잠시 저장해뒀다가 원래 주소로 쏘는 일인데, ASIO를 쓰면 얼마나 코드가 간단해질까 해서 만들어봤다. 이 코드는 서버에만 쓰고, 클라이언트에 붙일 넘은 IOCP까지는 필요없고 그냥 Win32 + winsock2 + 폴링 쓰레드로 만들어볼까 싶다.</p>
<pre><code>
class udp_relay_server
{
    struct relay_policy
    {
        udp::endpoint from_, to_;
        DWORD delay_;
    };

    struct relay_message
    {
        boost::shared_ptr&lt;std::string&gt; message_;
        udp::endpoint destination_;
        DWORD expire_clock_;
    };

    enum
    {
        MIN_SLEEP_DELAY = 10
    };

public:

    udp_relay_server(boost::asio::io_service&amp; io_service, short port)
        : socket_(io_service, udp::endpoint(udp::v4(), port))
        , timer_(io_service)
    {
        do_receive();
        do_timer();
    }

    udp_relay_server(boost::asio::io_service&amp; io_service, const udp::endpoint &amp; endpoint_ )
        : socket_(io_service, endpoint_)
        , timer_(io_service)
    {
        do_receive();
        do_timer();
    }

    void add_policy( const udp::endpoint &amp; from_, const udp::endpoint &amp; to_, DWORD delay = 0 )
    {
        relay_policy p;
        p.from_ = from_;
        p.to_ = to_;
        p.delay_ = delay;
        policies.push_back(p);
    }

    void add_policy( string from_addr, short from_port, string to_addr, short to_port, DWORD delay = 0 )
    {
        udp::endpoint from_( boost::asio::ip::address::from_string(from_addr), from_port );
        udp::endpoint to_( boost::asio::ip::address::from_string(to_addr), to_port );
        add_policy( from_, to_, delay );
    }

    void clear_policy() { policies.clear(); }

private:

    void do_timer()
    {
        timer_.expires_from_now(boost::posix_time::milliseconds(MIN_SLEEP_DELAY));
        timer_.async_wait(boost::bind(&amp;udp_relay_server::handle_timer,this,boost::asio::placeholders::error));
    }

    void handle_timer( const boost::system::error_code &amp; ec )
    {
        if ( !queue_.empty() )
        {
            DWORD cur_clock = GetTickCount();
            std::list&lt; relay_message &gt;::iterator itr = queue_.begin();
            while ( itr != queue_.end() )
            {
                relay_message &amp; m = *itr;
                if ( cur_clock &gt; m.expire_clock_ )
                {
                    socket_.async_send_to(boost::asio::buffer(*m.message_), m.destination_,
                        boost::bind(&amp;udp_relay_server::handle_send, this, m.message_, boost::asio::placeholders::error, boost::asio::placeholders::bytes_transferred) );
                    itr = queue_.erase(itr++);
                }
                else
                {
                    itr++;
                }
            }
        }
        do_timer();
    }

    void do_receive()
    {
        socket_.async_receive_from(
            boost::asio::buffer(recv_buffer_), remote_endpoint_,
            boost::bind(&amp;udp_relay_server::handle_receive, this,
            boost::asio::placeholders::error,
            boost::asio::placeholders::bytes_transferred));
    }

    void handle_receive(const boost::system::error_code&amp; error, std::size_t bytes_transferred)
    {
        if (!error)
        {
            bool bRelayed = false;
            for(size_t i = 0 ; i &lt; policies.size() ; i ++ )
            {
                relay_policy &amp; p = policies[i];
                if ( p.from_ == remote_endpoint_ )
                {
                    udp::endpoint relay_to(p.to_);
                    boost::shared_ptr&lt;std::string&gt; message(new string(recv_buffer_.data(),bytes_transferred));
                    if ( p.delay_ &gt; 0 )
                    {
                        relay_message m;
                        m.message_ = message;
                        m.destination_ = relay_to;
                        m.expire_clock_ = GetTickCount() + p.delay_;
                        queue_.push_back( m );
                    }
                    else
                    {
                        do_send( message, relay_to );
                    }
                    bRelayed = true;
                    break;
                }
            }
            do_receive();
        }
    }

    void do_send( boost::shared_ptr&lt;std::string&gt; message, const udp::endpoint &amp; destination )
    {
        socket_.async_send_to(boost::asio::buffer(*message), destination,
            boost::bind(&amp;udp_relay_server::handle_send, this,
                message, boost::asio::placeholders::error, boost::asio::placeholders::bytes_transferred) );
    }

    void handle_send(boost::shared_ptr&lt;std::string&gt; message, const boost::system::error_code&amp; error, std::size_t bytes_transferred )
    {
    }

    udp::socket socket_;
    udp::endpoint remote_endpoint_;
    boost::array&lt;char, 128&gt; recv_buffer_;
    vector&lt;relay_policy&gt; policies;
    boost::asio::deadline_timer timer_;
    std::list&lt; relay_message &gt; queue_;
};
</code></pre></div>
	
</article>
			
			<ul class="pager">
			
			  	<li class="previous">
			    	<a href="/page/18/">&larr; Older</a>
			  	</li>
		  	
		  	
				<li class="next">
					<a href="/page/18">Newer &rarr;</a>
				</li>
		  	
			</ul>
		</div>
		<div class="span3">
			<ul class="nav nav-list well">
	<li class="nav-header">
		Recent Posts
	</li>
	
	<li>
		<a href="/2008/05/01/customize-wordpress-prologue-theme/">Customize Wordpress Prologue theme</a>
	</li>
	
	<li>
		<a href="/2008/04/14/boost-with-visual-studio-2008-express/">boost with Visual Studio 2008 express</a>
	</li>
	
	<li>
		<a href="/2008/04/05/boost-135/">boost 1.35</a>
	</li>
	
	<li>
		<a href="/2008/03/21/svn-mkactivity-403-forbidden/">SVN MKACTIVITY 403 Forbidden</a>
	</li>
	
	<li>
		<a href="/2008/03/16/boost-asio-udp-relay-server/">boost::asio udp relay server</a>
	</li>
	
</ul>
		</div>
	</div>

</div> <!-- /container -->


    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
	
    <script src="/assets/js/jquery.js"></script>
    <script src="/assets/js/bootstrap.min.js"></script>
	

  </body>
</html>