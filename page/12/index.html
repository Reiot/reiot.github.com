<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
	<title>Rebooting Reiot</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description" content="Social Game Developer wandering strange dungeon...">
	<meta name="author" content="Ray Yun">

    <!-- Le styles -->
	
    <link href="/assets/css/bootstrap.min.css" rel="stylesheet">
    <style>
      body {
        padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
      }
    </style>
    <link href="/assets/css/bootstrap-responsive.min.css" rel="stylesheet">
	

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="/assets/ico/favicon.ico">
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="/assets/ico/apple-touch-icon-57-precomposed.png">
  </head>

  <body>

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="/">Rebooting Reiot</a>
          <div class="nav-collapse">
            <ul class="nav">
              <li class="active"><a href="/">Home</a></li>
              <li><a href="/archives/">Archives</a></li>
              <li><a href="/category/">Categories</a></li>
              <li><a href="/tag/">Tags</a></li>
			  
            </ul>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>

	
<div class="container">

	<div class="row">
		<div class="span9">
			
				<article>
	<div class="page-header">
		<h1><a href="/2009/01/20/boost-tuple-based-serialization/">boost tuple based serialization</a> <small>2009-01-20</small></h1>
	</div>
	<div><p>boost serialization를 사용하려면 이모저모로 귀찮은 점이 많아서, 생각해본 것이 <a href="http://docs.python.org/library/struct.html?highlight=pack">파이썬의 struct 라이브러리</a>와 같은 느낌으로 프로토콜 포맷을 정의하고, 이걸 boost tuple 코드로 뽑아낸다는 아이디어이다.</p>
<p>대강의 포맷은<br />
<table border="1" cellspacing="0" cellpadding="1"><br />
<tbody></tbody><br />
<thead><br />
<tr><br />
<th class="head">Format</th><br />
<th class="head">C Type</th><br />
<th class="head">Python</th><br />
<th class="head">Notes</th><br />
</tr><br />
</thead><br />
<tbody><br />
<tr><br />
<td><tt class="docutils literal">x</tt></td><br />
<td>pad byte</td><br />
<td>no value</td><br />
<td> </td><br />
</tr><br />
<tr><br />
<td><tt class="docutils literal">c</tt></td><br />
<td><tt class="xref docutils literal">char</tt></td><br />
<td>string of length 1</td><br />
<td> </td><br />
</tr><br />
<tr><br />
<td><tt class="docutils literal">b</tt></td><br />
<td><tt class="xref docutils literal">signed char</tt></td><br />
<td>integer</td><br />
<td> </td><br />
</tr><br />
<tr><br />
<td><tt class="docutils literal">B</tt></td><br />
<td><tt class="xref docutils literal">unsigned char</tt></td><br />
<td>integer</td><br />
<td> </td><br />
</tr><br />
<tr><br />
<td><tt class="docutils literal">?</tt></td><br />
<td><tt class="xref docutils literal">_Bool</tt></td><br />
<td>bool</td><br />
<td>(1)</td><br />
</tr><br />
<tr><br />
<td><tt class="docutils literal">h</tt></td><br />
<td><tt class="xref docutils literal">short</tt></td><br />
<td>integer</td><br />
<td> </td><br />
</tr><br />
<tr><br />
<td><tt class="docutils literal">H</tt></td><br />
<td><tt class="xref docutils literal">unsigned short</tt></td><br />
<td>integer</td><br />
<td> </td><br />
</tr><br />
<tr><br />
<td><tt class="docutils literal">i</tt></td><br />
<td><tt class="xref docutils literal">int</tt></td><br />
<td>integer</td><br />
<td> </td><br />
</tr><br />
<tr><br />
<td><tt class="docutils literal">I</tt></td><br />
<td><tt class="xref docutils literal">unsigned int</tt></td><br />
<td>integer or long</td><br />
<td> </td><br />
</tr><br />
<tr><br />
<td><tt class="docutils literal">l</tt></td><br />
<td><tt class="xref docutils literal">long</tt></td><br />
<td>integer</td><br />
<td> </td><br />
</tr><br />
<tr><br />
<td><tt class="docutils literal">L</tt></td><br />
<td><tt class="xref docutils literal">unsigned long</tt></td><br />
<td>long</td><br />
<td> </td><br />
</tr><br />
<tr><br />
<td><tt class="docutils literal">q</tt></td><br />
<td><tt class="xref docutils literal">long long</tt></td><br />
<td>long</td><br />
<td>(2)</td><br />
</tr><br />
<tr><br />
<td><tt class="docutils literal">Q</tt></td><br />
<td><tt class="xref docutils literal">unsigned long<br />
long</tt></td><br />
<td>long</td><br />
<td>(2)</td><br />
</tr><br />
<tr><br />
<td><tt class="docutils literal">f</tt></td><br />
<td><tt class="xref docutils literal">float</tt></td><br />
<td>float</td><br />
<td> </td><br />
</tr><br />
<tr><br />
<td><tt class="docutils literal">d</tt></td><br />
<td><tt class="xref docutils literal">double</tt></td><br />
<td>float</td><br />
<td> </td><br />
</tr><br />
<tr><br />
<td><tt class="docutils literal">s</tt></td><br />
<td><tt class="xref docutils literal">char[]</tt></td><br />
<td>string</td><br />
<td> </td><br />
</tr><br />
<tr><br />
<td><tt class="docutils literal">p</tt></td><br />
<td><tt class="xref docutils literal">char[]</tt></td><br />
<td>string</td><br />
<td> </td><br />
</tr><br />
<tr><br />
<td><tt class="docutils literal">P</tt></td><br />
<td><tt class="xref docutils literal">void *</tt></td><br />
<td>long</td><br />
<td> </td><br />
</tr><br />
</tbody></table><br />
가령 로그인 메시지를 "ppl" 이라는 포맷으로 정의하면, 파서는 이걸 읽고</p>
<p>typedef boost::tuple<string,string,long> msgLogin;</p>
<p>이라는 클래스를 정의한다는 거다. 요기에 좀 더 기능을 첨부하자면,</p>
<pre><code>- 64 bit integer
- datetime, smalldatetime 등 T-SQL 타입 지원(또는 매핑)
- STL 지원 : list, vector, map, set
- 비트 연산 지원 : B3은 바이트 타입인데 3비트만 읽고 쓴다는 뜻이 된다.
</code></pre>
<p>단점이라면 내부 멤버 접근을 userid, passwd 같은 이름 기반이 아니라 get&lt;1&gt;, get&lt;2&gt; 처럼 해야 한다는 점인데, 이건 좀 심하게 귀찮긴 하겠다. 역시 이름 기반 접근이 그나마 컴파일러가 검증해주니 제일 좋은 방법인가.</p>
<p>자. 만들어주세요.</p></div>
	
	<p>
	
		<a href="/tag/boost/"><span class="label">boost</span></a>
	
	</p>
	
</article>
			
				<article>
	<div class="page-header">
		<h1><a href="/2009/01/18/erlangotp-udp-server/">Erlang/OTP UDP Server</a> <small>2009-01-18</small></h1>
	</div>
	<div><p>얼랭으로 만든, 가장 단순한 UDP Echo 서버와 클라이언트는 이렇게 생겨먹었다. (워드프레스에서 들여쓰기가 자꾸 날아가는 버그가 있으므로, 귀찮아서 고치지는 않겠다.)</p>
<pre><code>
-module(udp_server).
-compile(export_all).

init(ServerPort) -&gt;
{ok, Sock} = gen_udp:open(ServerPort,[binary,inet]),
loop().

loop() -&gt;
io:format(&quot;server_loop~n&quot;),
receive
{udp, Sock, ClientIP, ClientPort, Packet } -&gt;
io:format(&quot;~p:~p ==&gt; ~p~n&quot;,[ClientIP,ClientPort,Packet]),
ok = gen_udp:send(Sock,ClientIP,ClientPort,Packet),
loop()
end.
</code></pre>

<pre><code>
-module(udp_client).
-compile(export_all).

init(ServerPort) -&gt;
{ok, Sock} = gen_udp:open(0),
gen_udp:send(Sock,&quot;localhost&quot;,ServerPort,&quot;Hello World!&quot;),
loop().

loop() -&gt;
io:format(&quot;waiting response...~n&quot;),
receive
{udp, Peer, PeerIP, PeerPort, Packet } -&gt;
io:format(&quot;~p:~p ==&gt; ~p~n&quot;,[PeerIP,PeerPort,Packet])
after 1000 -&gt;
io:format(&quot;timeout..~n&quot;)
end.

</code></pre>

<p>여기에서 바로 OTP로 만들겠다고 뛰어들었다가 삽질을 한 후,  <a href="http://www.trapexit.org/Building_a_Non-blocking_TCP_server_using_OTP_principles">Building_a_Non-blocking_TCP_server_using_OTP_principles</a> 와 <a href="http://erlrtpproxy.googlecode.com/svn-history/r19/trunk/rtpproxy.erl">구글에서 검색한 gen_udp 예제</a>을 참고해서 겨우 성공한 게 다음의 코드이다.</p>
<pre><code>
-module(udp_otp_server).
-compile(export_all).

% stand-alone server version
start() -&gt;
gen_server:start({local, ?MODULE}, ?MODULE, [], []).

% supervision tree version
start_link() -&gt;
gen_server:start_link({local, ?MODULE}, ?MODULE, [], []).

init([]) -&gt;
process_flag(trap_exit,true),
{ok, Sock} = gen_udp:open(1111,[binary,inet]),
io:format(&quot;udp server started...~n&quot;),
{ok,0}.

handle_call(Request, From, State) -&gt;
io:format(&quot;~p~n&quot;,[Request]),
{noreply,State}.

handle_cast(_Msg,State) -&gt;
io:format(&quot;handle_cast(~p)~n&quot;,_Msg),
{noreply, State}.

%% udp message should be handled here
handle_info({udp,Sock, ClientIP, ClientPort, Packet}, State) -&gt;
io:format(&quot;~p:~p ==&gt; ~p~n&quot;,[ClientIP,ClientPort,Packet]),
ok = gen_udp:send(Sock,ClientIP,ClientPort,Packet),
{noreply, State}
;

handle_info(_Info,State) -&gt;
io:format(&quot;handle_info~n&quot;),
{noreply, State}.

terminate(_Reason,N) -&gt;
io:format(&quot;stopping...~n&quot;),
ok.
code_change(_OldVsn,N, _Extra) -&gt; {ok,N}.

</code></pre>

<p>핵심 요지는, UDP 메시지는 handle_call 이나 cast 가 아니라, handle_info에서 처리해야 한다는 점이다. 요즘 <strong>업.무.가. 바.빠.서.</strong> 얼랭을 3주 정도 못봤는데 또 서서히 기억이 소멸하기 시작했다. OTP에서는 함수의 리턴값 규칙을 정말 잘 맞춰야 하는 관계로, 다음 번부터는 gen_server 템플릿 하나 정도는 갖고 시작해야겠다.</p></div>
	
	<p>
	
		<a href="/tag/erlang/"><span class="label">erlang</span></a>
	
	</p>
	
</article>
			
				<article>
	<div class="page-header">
		<h1><a href="/2009/01/12/teamcide/">Teamcide</a> <small>2009-01-12</small></h1>
	</div>
	<div><div>

[caption id="" align="alignnone" width="478" caption="Micro management (from conveniencebits.com)"]<a href="http://conveniencebits.com/2008/07/25/micromanaging-is-positive/">![Micromanagement](http://conveniencebits.com/pics/micromanage.jpg)</a>[/caption]

</div>

<div>Teamcide는 최근에 구독을 시작한 [코딩 호러](http://www.codinghorror.com/)의 [마이크로매니지먼트 좀비](http://www.codinghorror.com/blog/archives/001205.html)라는 글에서 발견한 7가지 팀관리의 안티 패턴이다. 알고 보니 피플웨어에서 소개된 이야기라고 해서 책을 찾아보려고 했는데, 어딘가에 쳐박혀 있는지 책이 보이지 않아, [일본어 웹문서 번역](http://translate.google.com/translate?prev=&hl=ko&ie=UTF-8&u=http://yuuntim.fc2web.com/chapter20.html&sl=auto&tl=ko&history_state0=)을 통해서 짤막하게만 정리해본다.</div>

<div>

    - 자기 방어적인 관리(Defensive Management)
    - 관료주의(Bureaucracy)
    - 팀원들을 여기 저기로 흩어 놓아서, 이동 거리를 멀게 하기(Physical Separation)
    - 한 명에게 여러 가지 작업을 시키기(Fragmentation of People's Time)
    - 납기일을 위해 품질을 희생하기(Quality Reduction of the Product)
    - 무의미한, 또는 가짜 데드라인(Phony Deadlines)
    - 파벌이 무서워서 프로젝트 종료 후 팀을 해체하기(Clique Control)

</div>

<p>거리 이야기는 이제 상식 수준이고, 마지막 파벌 이야기는 좀 비현실적이긴 한데, 가짜 데드라인 같은 이야기는 나도 종종 유혹을 느꼈기에, 이 시간을 빌어 씁쓸한 반성을 해본다.</p>
<p>때로는 빠른 의사 결정과 그에 따른 무한한 책임을 지는 <a href="http://seoworld.net/tt/261">잡스 같은 카리스마적인 독재자</a>와 일해보고 싶기도 하다. 다만, 거의 무개념 폭군이라는 이미지가 강한 초기의 잡스보다는, 이제 필 쉴러 아저씨에게 키노트 진행을 양보(?)한 최근의 잡스가 더 나을 것 같다.</p></div>
	
	<p>
	
		<a href="/tag/management/"><span class="label">management</span></a>
	
	</p>
	
</article>
			
				<article>
	<div class="page-header">
		<h1><a href="/2009/01/07/redmine/">Redmine</a> <small>2009-01-07</small></h1>
	</div>
	<div><p><a href="http://www.redmine.org/screenshots/gantt.png"><img alt="http://www.redmine.org/screenshots/gantt_tn.png" src="http://www.redmine.org/screenshots/gantt_tn.png" /></a></p>
<p><a href="http://bitnami.org/stack/mantis">bitnami mantis</a> 는 한글이 안되고, trac은 뭔가 플러그인 설치가 귀찮아서, 아<a href="http://www.redmine.org/wiki/redmine/Features">름다운 간트 차트</a>도 지원하는  <a href="http://bitnami.org/stack/redmine">bitnami redmine </a>을 써보기로 했다. (<a href="http://twiny.tistory.com/1676">twiny 님</a> 감사~)</p>
<p>평소대로라면 최신 버전(0.8)을 위해 ruby 와 rails 부터 설치했겠지만, 이런 삽질은 꿈도 못 꿀 정도로 바빠서, 그냥 0.7 버전을 마음 편하게 깔아버렸다. 한글 문제(이슈, 파일 업로드)는 전혀 없었고, SMTP와 https svn 저장소 연결만 남은 상태인데, 각각 한번씩 해보고 연결이 안되길래 과감하게 포기했다. 참고로, <a href="http://www.redmine.org/wiki/redmine/ThemeBasecamp">베이스캠프 테마</a>를 설치하면 mantis 보다 100배 미려한 화면을 볼 수 있다. :)</p>
<p>아쉬운 점이라면 위키 포맷이 익숙치 않은 textile 이라는 점과, 이미 <a href="http://www.gtdinbox.com/">GTDinbox </a>에 적응해버렸다는 정도. 그러고보니 GTD를 지원하는 이슈 관리 시스템은 없을까나~</p>
<p>ps. 드디어 SQL 2005 스키마의 개별 객체들을 <a href="http://www.sqlservercentral.com/articles/Administering/2896/">각각 SQL 로 추출해주는 방법</a>을 찾았다. 소스 코드르 다운받아서 약간만 수정해주면 SQL  스키마의 버전 관리는 끝!</p></div>
	
	<p>
	
		<a href="/tag/redmine/"><span class="label">redmine</span></a>
	
	</p>
	
</article>
			
				<article>
	<div class="page-header">
		<h1><a href="/2009/01/02/fault-tolerant-system/">Fault Tolerant System</a> <small>2009-01-02</small></h1>
	</div>
	<div><p>얼랭스터디에서 얼랭/OTP 의 무정지성(Fault Tolerance)에 대해서 소개하자,</p>
<pre><code>&quot;문제가 생긴 서버를 되살리는 것도 좋은데, 메모리상의 중요한 데이터들을 어떻게 다른 서버로 안전하게 전송할 수 있는가?&quot;```
라는 질문이 나왔다. 여기에 대해서 가장 먼저 떠오른 생각은
</code></pre>

<p>"클라이언트와의 연결은 어차피 날아가는 거고, 과연 그 서버 안에 있는 데이터까지 살릴 만한 가치가 있는 것일까?"```<br />
라는 것이었다. 일반적인 C++ 서버의 경우 오류로 인한 서버의 크래시가 발생했을 때 당연히 SEH 를 이용해서 그 순간을 캡처해낼 수는 있다. 그러나 문제는 그때의 메모리가 정말 DB에 저장하거나 다른 머신으로 보낼 만큼 신뢰성이 있는가? 하는 것이다. 치명적인 오류가 발생한지 시간이 좀 지나서, 이미 많은 데이터가 오염되었을 수도 있기 때문에, 보통은 그냥 데이터는 버리고 서버를 내려버리는 것이 정상이다.</p>
<p>그러다보니 무정지성이라는 의미에 대해서 다시금 생각하게 되었다. 그래서, 위키피디아에서 <a href="http://en.wikipedia.org/wiki/Fault-tolerant_system">Fault Tolerant System</a>을 검색해보니 다음과 같이 나와 있었다.</p>
<pre><code>
    - No single point of failure
    - No single point of repair
    - Fault isolation to the failing component
    - Fault containment to prevent propagation of the failure
    - Availability of reversion modes

</code></pre>

<p>즉, 하나 죽었다고 전체 시스템이 마비된다든지, 복구하다가 바보가 된다든지, 실패한 모듈 때문에 나머지 시스템이 동작하지 않는 등의 현상이 없어야 된다는, Five Nine(99.999%) 수준의 가용성(Availability)에 대한 이야기이지 완벽하게 모든 것이 재가동되어야 한다는 이야기는 아니었다. DB에도 오류가 생기면 롤백을 하듯이, MMO의 서버 시스템 역시 어느 수준으로 롤백을 하더라도 나머지 사용자들이 모를 정도로만 감춰줘도 사장님한테 이쁨받기에 충분한 수준인 것이다.</p>
<p>그런데, "<strong>진정한 변수</strong>"가 없는 얼랭에서는 - <em>정말 에러가 발생한 직후라는 확신이 든다면 </em>- 아래와 같은 코드를 이용해서, 오류를 다른 모듈로 확산시키지 않고도 로컬 코드 레벨에서 롤백이 가능하긴 하다.</p>
<pre><code>
loop( OldState ) -&gt;
try handle_something(msg,OldState) of
{ ok, NewState } -&gt;
loop(NewState)
catch
{ error } -&gt;
loop(OldState)
end
end.
</code></pre>

<p>여기에 얼랭/OTP의 슈퍼비전 트리가 결합하면 책에서 주장하는 것처럼 Nine Nine(99.9999999%)의 가용성이 보장된다고 하니, 초반에 생각했던 언어적 분산 네트워킹의 지원 보다는 이쪽이 더 매력적인 기능이 아닐까 싶다.</p></div>
	
	<p>
	
		<a href="/tag/erlang/"><span class="label">erlang</span></a>
	
	</p>
	
</article>
			
			<ul class="pager">
			
			  	<li class="previous">
			    	<a href="/page/13/">&larr; Older</a>
			  	</li>
		  	
		  	
				<li class="next">
					<a href="/page/13">Newer &rarr;</a>
				</li>
		  	
			</ul>
		</div>
		<div class="span3">
			<ul class="nav nav-list well">
	<li class="nav-header">
		Recent Posts
	</li>
	
	<li>
		<a href="/2009/01/20/boost-tuple-based-serialization/">boost tuple based serialization</a>
	</li>
	
	<li>
		<a href="/2009/01/18/erlangotp-udp-server/">Erlang/OTP UDP Server</a>
	</li>
	
	<li>
		<a href="/2009/01/12/teamcide/">Teamcide</a>
	</li>
	
	<li>
		<a href="/2009/01/07/redmine/">Redmine</a>
	</li>
	
	<li>
		<a href="/2009/01/02/fault-tolerant-system/">Fault Tolerant System</a>
	</li>
	
</ul>
		</div>
	</div>

</div> <!-- /container -->


    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
	
    <script src="/assets/js/jquery.js"></script>
    <script src="/assets/js/bootstrap.min.js"></script>
	

  </body>
</html>